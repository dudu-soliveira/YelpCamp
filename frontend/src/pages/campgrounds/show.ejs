<% layout('layout/boilerplate') %>

<div
  class="flex w-full flex-wrap items-center justify-evenly gap-x-20 gap-y-10 text-gray-900 self-start"
>
  <div
    class="flex max-w-2xl grow basis-[32rem] flex-col items-center gap-2 self-start sm:min-w-[32rem]"
  >

    <div
    id="imagesCarousel"
    class="relative w-full"
    data-twe-carousel-init
    data-twe-ride="carousel"
    >
    <!--Carousel indicators-->
    <% if (campground.images.length > 1) { %>
    <div
      class="absolute bottom-0 left-0 right-0 z-[2] mx-[15%] mb-4 flex list-none justify-center p-0"
      data-twe-carousel-indicators
    >
      <% for (let i = 0; i < campground.images.length; i++) { %>
      <button
        type="button"
        data-twe-target="#imagesCarousel"
        data-twe-slide-to="<%= i %>"
        <% if (!i) { %>
        data-twe-carousel-active
        aria-current="true"
        <% } %>
        class="mx-[3px] box-content h-[3px] w-[30px] flex-initial cursor-pointer border-0 border-y-[10px] border-solid border-transparent bg-white bg-clip-padding p-0 -indent-[999px] opacity-50 transition-opacity duration-[600ms] ease-[cubic-bezier(0.25,0.1,0.25,1.0)] motion-reduce:transition-none"
        aria-label="Slide <%= i + 1 %>"
      ></button>
      <% } %>
    </div>
    <% } %>

    <!--Carousel items-->
    <div
      class="relative w-full overflow-hidden after:clear-both after:block  after:content-['']"
    >
    <% for (let i = 0; i < campground.images.length; i++) { %>
      <div
      class="relative float-left -mr-[100%] <%= i !== 0 ? 'hidden' : '' %> w-full transition-transform duration-[600ms] ease-in-out motion-reduce:transition-none"
      data-twe-carousel-item
      <% if (!i) { %>
        data-twe-carousel-active
      <% } %>
    >
      <img
        src="<%= campground.images[i].url %>"
        class="block h-64 sm:h-96 w-full object-cover object-center"
        alt=""
        crossorigin="anonymous"
      />
    </div>
    <% } %>
    </div>

    <!--Carousel controls - prev item-->
    <% if (campground.images.length > 1) { %>
    <button
      class="absolute bottom-0 left-0 top-0 z-[1] flex w-[15%] items-center justify-center border-0 bg-none p-0 text-center text-white opacity-50 transition-opacity duration-150 ease-[cubic-bezier(0.25,0.1,0.25,1.0)] hover:text-white hover:no-underline hover:opacity-90 hover:outline-none focus:text-white focus:no-underline focus:opacity-90 focus:outline-none motion-reduce:transition-none"
      type="button"
      data-twe-target="#imagesCarousel"
      data-twe-slide="prev"
    >
      <span class="inline-block h-8 w-8">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="h-6 w-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.75 19.5L8.25 12l7.5-7.5"
          />
        </svg>
      </span>
      <span
        class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"
        >Previous</span
      >
    </button>
    <!--Carousel controls - next item-->
    <button
      class="absolute bottom-0 right-0 top-0 z-[1] flex w-[15%] items-center justify-center border-0 bg-none p-0 text-center text-white opacity-50 transition-opacity duration-150 ease-[cubic-bezier(0.25,0.1,0.25,1.0)] hover:text-white hover:no-underline hover:opacity-90 hover:outline-none focus:text-white focus:no-underline focus:opacity-90 focus:outline-none motion-reduce:transition-none"
      type="button"
      data-twe-target="#imagesCarousel"
      data-twe-slide="next"
    >
      <span class="inline-block h-8 w-8">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="h-6 w-6"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M8.25 4.5l7.5 7.5-7.5 7.5"
          />
        </svg>
      </span>
      <span
        class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"
        >Next</span
      >
    </button>
    <% } %>
    </div>

    <div class="flex w-full flex-col gap-5 p-4">
      <div>
        <h1 class="mb-2 text-4xl"><%= campground.title %></h1>
        <p class="font-light"><%= campground.description %></p>
      </div>
      <div>
        <p class="font-light text-gray-600"><%= campground.location %></p>
      </div>
      <div>
        <p>$<%= campground.price.toFixed(2) %>/night</p>
      </div>
      <div class="mb-2">
        <p class="text-sm font-light">
          Submitted by <a href="/users/<%= campground.author.username %>"><%= campground.author.username %></a>
        </p>
      </div>
      <% if (currentUser && campground.author.equals(currentUser._id)) { %>
      <div class="flex justify-between">
        <a href="/campgrounds/<%= campground._id %>/edit"
          ><button
            class="rounded-lg bg-cyan-700 px-5 py-2.5 text-center font-medium text-white hover:bg-cyan-800 focus:outline-none focus:ring-4 focus:ring-cyan-300 group-invalid:pointer-events-none group-invalid:opacity-30"
          >
            Edit
          </button></a
        >
        <form
          class="inline"
          action="/campgrounds/<%= campground._id %>?_method=DELETE"
          method="POST"
        >
          <button
            class="rounded-lg bg-red-700 px-5 py-2.5 text-center font-medium text-white hover:bg-red-800 focus:outline-none focus:ring-4 focus:ring-red-300"
          >
            Delete
          </button>
        </form>
      </div>
      <% } %>
    </div>
  </div>

  <div class="flex max-w-2xl grow flex-col gap-10 self-start sm:min-w-96">
    <div id="map" class="w-full h-72"></div>
    <% if (currentUser) { %>
    <div class="flex flex-col gap-6">
      <h2 class="text-3xl">Leave a Review</h2>
      <form
        class="group"
        action="/campgrounds/<%= campground._id %>/reviews"
        method="POST"
        novalidate
      >
        <fieldset class="starability-basic">
          <input
            type="radio"
            id="no-rate"
            class="input-no-rate"
            name="review[rating]"
            value="0"
            checked
            required
            aria-label="No rating."
          />
          <input type="radio" id="rating-1" name="review[rating]" value="1" />
          <label for="rating-1" title="Terrible">1 star</label>
          <input type="radio" id="rating-2" name="review[rating]" value="2" />
          <label for="rating-2" title="Not good">2 stars</label>
          <input type="radio" id="rating-3" name="review[rating]" value="3" />
          <label for="rating-3" title="Average">3 stars</label>
          <input type="radio" id="rating-4" name="review[rating]" value="4" />
          <label for="rating-4" title="Very good">4 stars</label>
          <input type="radio" id="rating-5" name="review[rating]" value="5" />
          <label for="rating-5" title="Amazing">5 stars</label>
        </fieldset>
        <div class="group relative z-0 mb-5 w-full">
          <textarea
            id="textarea"
            name="review[body]"
            class="peer block h-28 w-full resize-none appearance-none border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2.5 text-gray-900 transition-colors duration-300 valid:border-green-600 focus:border-blue-600 focus:outline-none focus:ring-0 valid:focus:border-green-600"
            placeholder=" "
            required
          ></textarea>
          <label
            for="textarea"
            class="absolute top-3 origin-[0] -translate-y-6 scale-75 transform bg-white text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-valid:text-green-600 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium peer-focus:text-blue-600 peer-[&:valid:focus]:text-green-600"
            ><span class="after:ml-0.5 after:text-red-600 after:content-['*']"
              >Description</span
            ></label
          >
        </div>
        <button
          type="submit"
          class="w-full rounded-lg bg-blue-700 px-5 py-2.5 text-center font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 group-invalid:pointer-events-none group-invalid:opacity-30 sm:w-auto"
        >
          Submit
        </button>
      </form>
    </div>
    <% } %>
    <div class="flex flex-col gap-5">
      <% for (let review of reviews) { %>
      <div
        class="relative flex w-full flex-col rounded-xl bg-transparent bg-clip-border text-gray-900 shadow-none"
      >
        <div
          class="relative mx-0 mt-4 flex items-center gap-4 overflow-hidden rounded-xl bg-transparent bg-clip-border pb-4 pt-0 text-gray-700 shadow-none"
        >
          <img
            src="<%= review.author.picture.url || '/images/profile.jpg' %>"
            alt="<%= review.author.username %>"
            class="relative inline-block h-10 w-10 !rounded-full object-cover object-center"
            crossorigin="anonymous"
          />
          <div class="flex w-full flex-col">
            <div class="flex items-center justify-between">
              <h5
                class="block text-lg font-semibold leading-snug tracking-normal antialiased"
              >
                <%= review.author.username %>
              </h5>
              <div class="flex items-center">
                <p
                  class="starability-result"
                  data-rating="<%= review.rating %>"
                >
                  Rated: <%= review.rating %> stars
                </p>
              </div>
            </div>
            <p class="block text-sm font-light leading-relaxed antialiased">
              <%= review.author.email %>
            </p>
          </div>
        </div>
        <div class="mb-3 p-0">
          <p class="block font-light text-gray-700 antialiased">
            <%= review.body %>
          </p>
        </div>
        <% if (currentUser && review.author.equals(currentUser._id)) { %>
        <form
          class="flex justify-end"
          action="/campgrounds/<%= campground._id %>/reviews/<%= review._id %>?_method=DELETE"
          method="POST"
        >
          <button
            class="w-auto rounded border border-gray-700 px-1 py-1 text-center text-sm font-medium hover:border-gray-700 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-4 focus:ring-red-300"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              class="bi bi-trash"
              viewBox="0 0 16 16"
            >
              <path
                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"
              />
              <path
                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"
              />
            </svg>
          </button>
        </form>
        <% } %>
      </div>
      <% } %>
    </div>
  </div>
</div>
