<% layout('layout/boilerplate') %>

<div class="flex w-full grow flex-wrap items-start justify-evenly gap-14">
  <div
    class="flex w-full max-w-[38rem] flex-col justify-center gap-6 rounded px-5 py-6 shadow-xl xl:sticky xl:top-28 xl:py-10"
  >
    <div class="flex w-full flex-wrap items-center justify-evenly gap-4">
      <div>
        <button
          type="button"
          class="relative flex rounded-full border-2 border-white text-sm focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-offset-2 focus:ring-offset-gray-700"
          id="picture"
        >
          <span class="absolute -inset-1.5"></span>
          <span class="sr-only">Open user menu</span>
          <img
            class="h-32 w-32 rounded-full object-cover object-center"
            src="<%= picture ? picture.url : '/images/profile.jpg' %>"
            alt=""
          />
        </button>
      </div>
      <% if (currentUser.username === username) { %>
      <div id="pictureForms" class="hidden w-72 max-w-96 grow self-center pt-2">
        <% if (picture) { %>
        <form
          action="/users/<%= username %>/picture?_method=DELETE"
          id="deletePictureForm"
          class="hidden"
          method="POST"
        ></form>
        <% } %>
        <form
          action="/users/<%= username %>/picture?_method=PUT"
          id="editPictureForm"
          class="group"
          method="POST"
          enctype="multipart/form-data"
          novalidate
        >
          <div class="group relative z-0 mb-5 w-full">
            <input
              type="file"
              name="editPicture"
              id="editPicture"
              class="peer block w-full border-0 border-b-2 border-gray-300 px-0 py-2.5 file:mr-5 file:border-0 file:bg-transparent file:p-0 file:text-sm file:font-medium file:text-blue-600 valid:border-green-600 hover:file:cursor-pointer hover:file:text-blue-400"
              accept=".png,.jpeg,.jpg"
              required
            />
            <label
              for="editPicture"
              class="absolute top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform font-medium text-gray-500 duration-300 peer-valid:text-green-600"
              ><span>Edit picture</span>
            </label>
          </div>
          <div class="flex justify-between">
            <button
              type="submit"
              class="rounded-lg bg-cyan-700 px-5 py-2.5 text-center font-medium text-white hover:bg-cyan-800 focus:outline-none focus:ring-4 focus:ring-cyan-300 group-invalid:pointer-events-none group-invalid:opacity-30"
            >
              Edit
            </button>
            <% if (picture) { %>
            <button
              type="submit"
              form="deletePictureForm"
              class="rounded-lg bg-red-700 px-5 py-2.5 text-center font-medium text-white hover:bg-red-800 focus:outline-none focus:ring-4 focus:ring-red-300"
            >
              Delete
            </button>
            <% } %>
          </div>
        </form>
      </div>
      <% } %>
    </div>
    <div>
      <% if (currentUser.username === username) { %>
      <form
        action="/users/<%= username %>?_method=PUT"
        class="group"
        method="POST"
        novalidate
      >
        <% } %>
        <h1 class="mb-7 text-4xl text-gray-900"><%= username %></h1>
        <div class="group relative z-0 mb-5 w-full">
          <h2
            id="emailShow"
            class="block w-full appearance-none border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2.5 text-gray-900"
          >
            <span
              class="absolute start-0 top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-gray-500"
              >Email</span
            ><%= email %> <% if (currentUser.username === username) { %>
            <span
              id="editEmailIcon"
              class="absolute right-2 top-4 hover:cursor-pointer"
              ><img class="h-4 w-4" src="/images/edit-icon.svg" alt=""
            /></span>
            <% } %>
          </h2>
          <% if (currentUser.username === username) { %>
          <input
            type="email"
            name="email"
            id="emailInput"
            class="peer hidden w-full appearance-none border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2.5 text-gray-900 transition-colors duration-300 valid:border-green-600 focus:border-blue-600 focus:outline-none focus:ring-0 valid:focus:border-green-600 invalid:[&:not(:placeholder-shown):not(:focus)]:border-red-600 invalid:[&:not(:placeholder-shown)]:border-red-600"
            placeholder=" "
            disabled
          />
          <label
            for="emailInput"
            class="absolute top-3 -z-10 hidden origin-[0] -translate-y-6 scale-75 transform text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-valid:text-green-600 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium peer-focus:text-blue-600 peer-[&:invalid:focus:not(:placeholder-shown)]:text-red-600 peer-[&:invalid:not(:placeholder-shown)]:text-red-600 peer-[&:valid:focus]:text-green-600"
            ><span class="after:ml-0.5 after:text-red-600 after:content-['*']"
              >Email</span
            ></label
          >
          <label
            for="emailInput"
            id="closeEmailIcon"
            class="absolute right-2 top-4 hidden text-gray-900 hover:cursor-pointer"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12"
              /></svg
          ></label>
          <span
            class="mt-2 hidden text-sm text-red-600 peer-[&:invalid:not(:placeholder-shown)]:block"
          >
            Please enter a valid email
          </span>
          <% } %>
        </div>
        <% if (currentUser.username === username) { %>
        <div class="group relative z-0 mb-5 w-full">
          <h2
            id="passwordShow"
            class="block w-full appearance-none border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2.5 text-gray-900"
          >
            <span
              class="absolute start-0 top-3 -z-10 origin-[0] -translate-y-6 scale-75 transform text-gray-500"
              >Password</span
            >••••••••••
            <span
              id="editPasswordIcon"
              class="absolute right-2 top-4 hover:cursor-pointer"
              ><img class="h-4 w-4" src="/images/edit-icon.svg" alt=""
            /></span>
          </h2>
          <input
            type="password"
            name="oldPassword"
            id="oldPassword"
            class="peer hidden w-full appearance-none border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2.5 text-gray-900 transition-colors duration-300 valid:border-green-600 focus:border-blue-600 focus:outline-none focus:ring-0 valid:focus:border-green-600 invalid:[&:not(:placeholder-shown):not(:focus)]:border-red-600 invalid:[&:not(:placeholder-shown)]:border-red-600"
            placeholder=" "
            disabled
          />
          <label
            for="oldPassword"
            class="absolute top-3 -z-10 hidden origin-[0] -translate-y-6 scale-75 transform text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-valid:text-green-600 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium peer-focus:text-blue-600 peer-[&:invalid:focus:not(:placeholder-shown)]:text-red-600 peer-[&:invalid:not(:placeholder-shown)]:text-red-600 peer-[&:valid:focus]:text-green-600"
            ><span class="after:ml-0.5 after:text-red-600 after:content-['*']"
              >Old password</span
            ></label
          >
          <label
            for="oldPassword"
            id="closePasswordIcon"
            class="absolute right-2 top-4 hidden text-gray-900 hover:cursor-pointer"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6 18L18 6M6 6l12 12"
              /></svg
          ></label>
        </div>
        <div class="group relative z-0 w-full">
          <input
            type="password"
            name="newPassword"
            id="newPassword"
            class="peer mb-5 hidden w-full appearance-none border-0 border-b-2 border-gray-300 bg-transparent px-0 py-2.5 text-gray-900 transition-colors duration-300 valid:border-green-600 focus:border-blue-600 focus:outline-none focus:ring-0 valid:focus:border-green-600 invalid:[&:not(:placeholder-shown):not(:focus)]:border-red-600 invalid:[&:not(:placeholder-shown)]:border-red-600"
            placeholder=" "
            disabled
          />
          <label
            for="newPassword"
            class="absolute top-3 -z-10 hidden origin-[0] -translate-y-6 scale-75 transform text-gray-500 duration-300 peer-placeholder-shown:translate-y-0 peer-placeholder-shown:scale-100 peer-valid:text-green-600 peer-focus:start-0 peer-focus:-translate-y-6 peer-focus:scale-75 peer-focus:font-medium peer-focus:text-blue-600 peer-[&:invalid:focus:not(:placeholder-shown)]:text-red-600 peer-[&:invalid:not(:placeholder-shown)]:text-red-600 peer-[&:valid:focus]:text-green-600"
            ><span class="after:ml-0.5 after:text-red-600 after:content-['*']"
              >New password</span
            ></label
          >
        </div>
        <button
          type="submit"
          id="profileEditButton"
          class="hidden w-full rounded-lg bg-blue-700 px-5 py-2.5 text-center font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 group-invalid:pointer-events-none group-invalid:opacity-30 sm:w-auto"
        >
          Submit
        </button>
      </form>
      <% } %>
    </div>
  </div>
  <% if (campgrounds.length) { %>
  <div class="w-full max-w-xl self-start">
    <h2 class="mb-10 text-center text-4xl font-bold">Campgrounds</h2>
    <div class="flex flex-wrap gap-6 text-gray-900">
      <% for (let i = 0; i < campgrounds.length; i++) { %>
      <div class="w-full">
        <a
          href="/campgrounds/<%= campgrounds[i]._id %>"
          class="flex flex-col items-center rounded-lg border border-gray-200 bg-white shadow hover:bg-gray-100"
        >
          <img
            class="h-56 w-full rounded-t-lg object-cover object-center sm:h-72"
            src="<%= campgrounds[i].images[0].url.replace('upload/', 'upload/w_800/') %>"
            crossorigin="anonymous"
          />
          <div class="flex flex-col justify-between self-start p-4">
            <h5 class="mb-2 text-2xl font-bold tracking-tight">
              <%= campgrounds[i].title %>
            </h5>
            <h6>Price: $<%= campgrounds[i].price %></h6>
            <h6>Location: <%= campgrounds[i].location %></h6>
          </div>
        </a>
      </div>
      <% } %>
    </div>
  </div>
  <% } %>
</div>
